<div *ngIf="data.type === 'detail'">
    <mat-toolbar color="primary">
        <img class="imgEseDialog" alt="logo" title="logo" src="assets/images/logos/ese-logo.png">
        <span class="spacer-r"></span>
        <mat-icon svgIcon="account-card-details"></mat-icon>
        <span>&nbsp;&nbsp;</span>
        <h1 mat-dialog-title>Detalles de Usuario</h1>
    </mat-toolbar>
    <mat-divider></mat-divider>
    <mat-list class="listContainer">
        <mat-list-item>
            <img matListAvatar [src]="sanitizer.bypassSecurityTrustResourceUrl('data:'+user?.avatar.type+';base64,' + user?.avatar.data)"
                alt="{{privilege}}" (click)="imageZoom.openDialogImage()">
            <h3 matLine> {{user.firstName}} {{user.lastName}} </h3>
            <p matLine>
                <span class="role-style">{{rolesToSpanish(user.roles)}}</span>
            </p>
            <nx-image-zoom #imageZoom [user]="user" [uriRole]="uriRole"></nx-image-zoom>
        </mat-list-item>

    </mat-list>
    <mat-divider></mat-divider>
    <mat-dialog-content>
        <mat-tab-group dynamicHeight="true">
            <mat-tab label="Información Personal">
                <div class="tab-content">

                    <mat-form-field appearance="fill">
                        <input matInput [(ngModel)]="user.username" readonly>
                        <mat-label>
                            <i class="mdi mdi-account-circle material-icons app-input-icon"></i>Nombre de usuario
                        </mat-label>
                    </mat-form-field>

                    <mat-form-field appearance="fill">
                        <input matInput [(ngModel)]="user.dni" readonly>
                        <mat-label>
                            <i class="mdi mdi-barcode material-icons app-input-icon"></i>RUT
                        </mat-label>
                    </mat-form-field>

                    <mat-form-field appearance="fill">
                        <input matInput [(ngModel)]="user.birthday" readonly>
                        <mat-label>
                            <i class="mdi mdi-cake-variant material-icons app-input-icon"></i>Fecha de Nacimiento
                        </mat-label>
                    </mat-form-field>

                    <mat-form-field appearance="fill">
                        <input matInput [(ngModel)]="user.gender" readonly>
                        <mat-label>
                            <i class="mdi mdi-gender-male-female material-icons app-input-icon"></i>Genero
                        </mat-label>
                    </mat-form-field>

                </div>
            </mat-tab>

            <mat-tab label="Información de Contacto">
                <div class="tab-content">

                    <mat-form-field appearance="fill">
                        <mat-label>
                            <i class="mdi mdi-phone material-icons app-input-icon"></i>Teléfono
                        </mat-label>
                        <input matInput [(ngModel)]="user.mobile" readonly>
                    </mat-form-field>

                    <mat-form-field appearance="fill">
                        <input matInput [(ngModel)]="user.email" readonly>
                        <mat-label>
                            <i class="mdi mdi-email material-icons app-input-icon"></i>Email
                        </mat-label>
                    </mat-form-field>

                    <mat-form-field appearance="fill">
                        <input matInput [(ngModel)]="user.address" readonly>
                        <mat-label>
                            <i class="mdi mdi-account-location material-icons app-input-icon"></i>Dirección
                        </mat-label>
                    </mat-form-field>

                    <mat-form-field appearance="fill">
                        <input matInput [(ngModel)]="user.commune" readonly>
                        <mat-label>
                            <i class="mdi mdi-map-marker material-icons app-input-icon"></i>Comuna
                        </mat-label>
                    </mat-form-field>

                </div>
            </mat-tab>
        </mat-tab-group>
    </mat-dialog-content>
    <mat-divider></mat-divider>
    <mat-dialog-actions>
        <mat-toolbar>
            <button type="button" mat-mini-fab color="primary" tabindex="1" (click)="cancel()" matTooltip="volver" cdkFocusRegionstart>
                <mat-icon svgIcon="arrow-left"></mat-icon>
            </button>
            <span class="spacer-r"></span>
            <button type="button" mat-raised-button color="accent" tabindex="2" (click)="detailEdit()">Editar</button>
            <button type="button" mat-raised-button color="warn" tabindex="3" (click)="detailDelete()">Borrar</button>
        </mat-toolbar>
    </mat-dialog-actions>
</div>

<div *ngIf="data.type === 'create'">
    <form [formGroup]="createForm" (ngSubmit)="create()">

        <mat-toolbar color="primary">
            <img class="imgEseDialog" alt="logo" title="logo" src="assets/images/logos/ese-logo.png">
            <span class="spacer-r"></span>
            <mat-icon svgIcon="account-plus"></mat-icon>
            <span>&nbsp;&nbsp;</span>
            <h1 mat-dialog-title>Agregar {{privilege}}</h1>
        </mat-toolbar>
        <mat-divider></mat-divider>
        <mat-list class="listContainer">
            <mat-list-item>
                <img matListAvatar src="assets/images/users/male-{{privilege}}.svg" alt="{{privilege}}" (click)="fileInput.inputElement.click()"
                    (keyup.enter)="fileInput.inputElement.click()">
                <h3 matLine> {{user.firstName}} {{user.lastName}} </h3>
                <p matLine>
                    <span *ngIf="privilege" class="role-style">{{privilegeToSpanish(privilege)}}</span>
                </p>
            </mat-list-item>
        </mat-list>
        <mat-divider></mat-divider>
        <mat-dialog-content>
            <mat-tab-group dynamicHeight="true">
                <mat-tab label="Información Personal">
                    <div class="tab-content">

                        <mat-form-field appearance="standard">
                            <input matInput formControlName="firstName" required>
                            <mat-label>
                                <i class="mdi mdi-account material-icons app-input-icon"></i>Nombres
                            </mat-label>
                            <mat-error *ngIf="cFirstName.hasError('required')">Nombre de Usuario es
                                <strong>requerido</strong>.
                            </mat-error>
                        </mat-form-field>

                        <mat-form-field appearance="standard">
                            <input matInput formControlName="lastName" required>
                            <mat-label>
                                <i class="mdi mdi-account-outline material-icons app-input-icon"></i>Apellidos
                            </mat-label>
                            <mat-error *ngIf="cLastName.hasError('required')">Nombre de Usuario es
                                <strong>requerido</strong>.</mat-error>
                        </mat-form-field>

                        <mat-form-field appearance="standard">
                            <input matInput formControlName="dni">
                            <mat-label>
                                <i class="mdi mdi-barcode material-icons app-input-icon"></i>RUT
                            </mat-label>
                        </mat-form-field>

                        <mat-form-field appearance="standard">
                            <input matInput [matDatepicker]="picker" formControlName="birthday">
                            <mat-label>
                                <i class="mdi mdi-cake-variant material-icons app-input-icon"></i>Fecha de Nacimiento
                            </mat-label>
                            <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                            <mat-datepicker #picker></mat-datepicker>
                        </mat-form-field>

                        <mat-form-field appearance="standard">
                            <mat-select formControlName="gender">
                                <mat-option *ngFor="let gender of genders" [value]="gender.value">
                                    {{ gender.viewValue }}
                                </mat-option>
                            </mat-select>
                            <mat-label>
                                <i class="mdi mdi-gender-male-female material-icons app-input-icon"></i>Genero
                            </mat-label>
                        </mat-form-field>

                        <mat-form-field appearance="fill" tdFileDrop (fileDrop)="files = $event" (click)="fileInput.inputElement.click()" (keyup.enter)="fileInput.inputElement.click()"
                            (keyup.delete)="fileInput.clear()" (keyup.backspace)="fileInput.clear()" flex>

                            <input matInput [value]="files?.length ? (files?.length + ' files') : files?.name" style="cursor:pointer" readonly>
                            <mat-label>
                                <i class="mdi mdi-camera material-icons app-input-icon"></i>Foto de Perfil
                            </mat-label>

                            <button mat-icon-button matSuffix *ngIf="files" (click)="fileInput.clear(); $event.stopPropagation()" (keyup.enter)="fileInput.clear()">
                                <mat-icon svgIcon="close-circle" class="iconRemove"></mat-icon>
                            </button>

                            <td-file-input hidden class="push-left-sm push-right-sm" #fileInput [(ngModel)]="files" [ngModelOptions]="{standalone:true}"
                                (select)="selectEventCreate($event)">
                                <mat-icon svgIcon="folder-upload"></mat-icon>
                                <span class="text-upper">Buscar...</span>
                            </td-file-input>
                        </mat-form-field>
                    </div>
                </mat-tab>

                <mat-tab label="Información de Contacto">
                    <div class="tab-content">

                        <mat-form-field appearance="standard">
                            <input matInput formControlName="mobile" #mobileCreate maxlength="9">
                            <mat-label>
                                <i class="mdi mdi-phone material-icons app-input-icon"></i>Teléfono
                            </mat-label>
                            <mat-hint align="end">{{mobileCreate.value?.length || 0}}/9</mat-hint>
                        </mat-form-field>

                        <mat-form-field appearance="standard">
                            <input matInput formControlName="email">
                            <mat-label>
                                <i class="mdi mdi-email material-icons app-input-icon"></i>Email
                            </mat-label>
                        </mat-form-field>

                        <mat-form-field appearance="standard">
                            <input matInput formControlName="address">
                            <mat-label>
                                <i class="mdi mdi-account-location material-icons app-input-icon"></i>Dirección
                            </mat-label>
                        </mat-form-field>

                        <mat-form-field appearance="standard">
                            <mat-select formControlName="commune">
                                <mat-option *ngFor="let commune of communes" [value]="commune.value">
                                    {{ commune.viewValue }}
                                </mat-option>
                            </mat-select>
                            <mat-label>
                                <i class="mdi mdi-map-marker material-icons app-input-icon"></i>Comuna
                            </mat-label>
                        </mat-form-field>
                    </div>
                </mat-tab>
            </mat-tab-group>

        </mat-dialog-content>
        <mat-divider></mat-divider>
        <mat-dialog-actions>
            <mat-toolbar>
                <button type="button" mat-mini-fab color="primary" tabindex="1" (click)="cancel()" matTooltip="volver" cdkFocusRegionstart>
                    <mat-icon svgIcon="arrow-left"></mat-icon>
                </button>
                <span class="spacer-r"></span>
                <button type="submit" mat-raised-button color="accent" tabindex="2" [disabled]="!createForm.valid">Agregar</button>
            </mat-toolbar>
        </mat-dialog-actions>
    </form>
</div>

<div *ngIf="data.type === 'edit'">
    <form [formGroup]="editForm" (ngSubmit)="save()">

        <mat-toolbar color="primary">
            <img class="imgEseDialog" alt="logo" title="logo" src="assets/images/logos/ese-logo.png">
            <span class="spacer-r"></span>
            <mat-icon svgIcon="account-edit"></mat-icon>
            <span>&nbsp;&nbsp;</span>
            <h1 mat-dialog-title>Editar Usuario</h1>
        </mat-toolbar>
        <mat-divider></mat-divider>
        <mat-list class="listContainer">
            <mat-list-item>
                <img matListAvatar [src]="sanitizer.bypassSecurityTrustResourceUrl('data:'+user?.avatar.type+';base64,' + user?.avatar.data)"
                    alt="{{privilege}}" [matMenuTriggerFor]="avatarMenu">
                <h3 matLine> {{user.firstName}} {{user.lastName}} </h3>
                <p matLine>
                    <span class="role-style">{{rolesToSpanish(user.roles)}}</span>
                </p>

                <mat-menu x-position="before" #avatarMenu="matMenu" [overlapTrigger]="false">
                    <button mat-menu-item (click)="imageZoom.openDialogImage()">
                        <mat-icon svgIcon="eye"></mat-icon>
                        <span> Ver Imagen </span>
                    </button>
                    <button mat-menu-item (click)="fileInput.inputElement.click()" (keyup.enter)="fileInput.inputElement.click()">
                        <mat-icon svgIcon="camera"></mat-icon>
                        <span> Cambiar Imagen </span>
                    </button>
                </mat-menu>
            </mat-list-item>
            <nx-image-zoom #imageZoom [user]="user" [uriRole]="uriRole"></nx-image-zoom>
        </mat-list>
        <mat-divider></mat-divider>
        <mat-dialog-content>
            <mat-tab-group dynamicHeight="true">
                <mat-tab label="Datos de Usuario">
                    <div class="tab-content">

                        <mat-form-field appearance="standard">
                            <mat-label>
                                <i class="mdi mdi-account-circle material-icons app-input-icon"></i>Nombre de Usuario
                            </mat-label>
                            <input matInput formControlName="username" required>
                            <i class="mdi mdi-pencil material-icons app-input-icon" matSuffix></i>
                            <mat-error *ngIf="eUsername.hasError('required')">Nombre de Usuario es
                                <strong>requerido</strong>.
                            </mat-error>
                        </mat-form-field>

                        <mat-form-field appearance="fill" tdFileDrop (fileDrop)="files = $event" (click)="fileInput.inputElement.click()" (keyup.enter)="fileInput.inputElement.click()"
                            (keyup.delete)="fileInput.clear()" (keyup.backspace)="fileInput.clear()" flex>

                            <mat-label>
                                <i class="mdi mdi-camera material-icons app-input-icon"></i>Foto de Perfil
                            </mat-label>
                            <input matInput [value]="files?.length ? (files?.length + ' files') : files?.name" style="cursor:pointer" readonly>

                            <button mat-icon-button matSuffix *ngIf="files" (click)="fileInput.clear(); $event.stopPropagation()" (keyup.enter)="fileInput.clear()">
                                <mat-icon svgIcon="close-circle" class="iconRemove"></mat-icon>
                            </button>

                            <td-file-input hidden class="push-left-sm push-right-sm" #fileInput [(ngModel)]="files" [ngModelOptions]="{standalone:true}"
                                (select)="selectEventEdit($event)">
                                <mat-icon svgIcon="folder-upload"></mat-icon>
                                <span class="text-upper">Buscar...</span>
                            </td-file-input>
                        </mat-form-field>

                        <mat-form-field appearance="outline" floatLabel="always">
                            <mat-label>
                                <i class="mdi mdi-lock material-icons app-input-icon"></i>Contraseña de Usuario
                            </mat-label>
                            <input matInput readonly>
                            <mat-hint>
                                <strong>Esto cambiará la contraseña del usuario</strong>
                            </mat-hint>
                            <button type="button" mat-raised-button color="warn" class="buttonResetPass" (click)="resetPass.openDialogResetPass()">
                                <mat-icon svgIcon="lock-reset"></mat-icon>&nbsp; Restablecer Contraseña
                            </button>
                            <nx-reset-pass #resetPass [user]="user" [uriRole]="uriRole"></nx-reset-pass>
                        </mat-form-field>

                        <mat-form-field appearance="standard" *ngIf="isAdmin && (privilege!='student')">
                            <mat-select formControlName="roles" multiple required>
                                <!--  <mat-select-trigger>
                                    {{eRoles.value ? eRoles.value[0] : ''}}
                                    <span *ngIf="eRoles.value?.length > 1" class="example-additional-selection">
                                        (+{{eRoles.value.length - 1}} otros)
                                    </span>
                                </mat-select-trigger>!-->
                                <mat-select-trigger>
                                    <mat-chip-list>
                                        <mat-chip *ngFor="let eRole of eRoles.value" class="chip-selection" [color]="(eRole ==='MANAGER')? 'primary':'accent' " selected="true">
                                            {{privilegeToSpanish(eRole)}}
                                        </mat-chip>
                                    </mat-chip-list>
                                </mat-select-trigger>
                                <mat-option *ngFor="let role of rolesList" [value]="role.value">
                                    {{role.viewValue}}
                                </mat-option>
                            </mat-select>
                            <mat-label>
                                <i class="mdi mdi-security-account material-icons app-input-icon"></i>Añadir o remover Privilegios
                            </mat-label>
                            <mat-error *ngIf="eRoles.hasError('required')">Al menos un privilegio es
                                <strong>requerido</strong>.
                            </mat-error>
                            <button type="button" mat-mini-fab color="warn" (click)="setRoles.openDialogSetRoles(); $event.stopPropagation()" matSuffix
                                matTooltip="Guardar Privilegio(s)" [disabled]="eRoles.pristine || eRoles.invalid">
                                <mat-icon svgIcon="content-save"></mat-icon>
                            </button>
                            <mat-hint>
                                <strong>Esto cambiará los privilegios del usuario</strong>
                            </mat-hint>
                            <nx-set-roles #setRoles [user]="editForm.value" [uriRole]="uriRole"></nx-set-roles>
                        </mat-form-field>

                    </div>
                </mat-tab>

                <mat-tab label="Datos Personales">
                    <div class="tab-content">

                        <mat-form-field appearance="standard">
                            <input matInput formControlName="firstName" required>
                            <mat-label>
                                <i class="mdi mdi-account material-icons app-input-icon"></i>Nombres
                            </mat-label>
                            <i class="mdi mdi-pencil material-icons app-input-icon" matSuffix></i>
                            <mat-error *ngIf="eFirstName.hasError('required')">Nombre es
                                <strong>requerido</strong>.
                            </mat-error>
                        </mat-form-field>

                        <mat-form-field appearance="standard">
                            <mat-label>
                                <i class="mdi mdi-account-outline material-icons app-input-icon"></i>Apellidos
                            </mat-label>
                            <input matInput formControlName="lastName" required>
                            <i class="mdi mdi-pencil material-icons app-input-icon" matSuffix></i>
                            <mat-error *ngIf="eLastName.hasError('required')">Apellido es
                                <strong>requerido</strong>.
                            </mat-error>
                        </mat-form-field>

                        <mat-form-field appearance="standard">
                            <input matInput formControlName="dni">
                            <mat-label>
                                <i class="mdi mdi-barcode material-icons app-input-icon"></i>RUT
                            </mat-label>
                            <i class="mdi mdi-pencil material-icons app-input-icon" matSuffix></i>
                        </mat-form-field>

                        <mat-form-field appearance="standard">
                            <input matInput [matDatepicker]="picker" formControlName="birthday">
                            <mat-label>
                                <i class="mdi mdi-cake-variant material-icons app-input-icon"></i>Fecha de Nacimiento
                            </mat-label>
                            <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                            <mat-datepicker #picker></mat-datepicker>
                        </mat-form-field>

                        <mat-form-field appearance="standard">
                            <mat-select formControlName="gender" [compareWith]="compareFn">
                                <mat-option *ngFor="let gender of genders" [value]="gender.viewValue">
                                    {{ gender.viewValue }}
                                </mat-option>
                            </mat-select>
                            <mat-label>
                                <i class="mdi mdi-gender-male-female material-icons app-input-icon"></i>Genero
                            </mat-label>
                        </mat-form-field>


                    </div>
                </mat-tab>

                <mat-tab label="Datos de Contacto">
                    <div class="tab-content">

                        <mat-form-field appearance="standard">
                            <input matInput [type]="tel" formControlName="mobile" #mobileEdit maxlength="9">
                            <mat-label>
                                <i class="mdi mdi-phone material-icons app-input-icon"></i>Telefóno
                            </mat-label>
                            <i class="mdi mdi-pencil material-icons app-input-icon" matSuffix></i>
                            <mat-hint align="end">{{mobileEdit.value?.length || 0}}/9</mat-hint>
                        </mat-form-field>

                        <mat-form-field appearance="standard">
                            <input matInput formControlName="email">
                            <mat-label>
                                <i class="mdi mdi-email material-icons app-input-icon"></i>Email
                            </mat-label>
                            <i class="mdi mdi-pencil material-icons app-input-icon" matSuffix></i>
                        </mat-form-field>

                        <mat-form-field appearance="standard">
                            <input matInput formControlName="address">
                            <mat-label>
                                <i class="mdi mdi-account-location material-icons app-input-icon"></i>Dirección
                            </mat-label>
                            <i class="mdi mdi-pencil material-icons app-input-icon" matSuffix></i>
                        </mat-form-field>

                        <mat-form-field appearance="standard">
                            <mat-select formControlName="commune" [compareWith]="compareFn">
                                <mat-option *ngFor="let commune of communes" [value]="commune.viewValue">
                                    {{ commune.viewValue }}
                                </mat-option>
                            </mat-select>
                            <mat-label>
                                <i class="mdi mdi-map-marker material-icons app-input-icon"></i>Comuna
                            </mat-label>
                        </mat-form-field>

                    </div>
                </mat-tab>
            </mat-tab-group>
        </mat-dialog-content>
        <mat-divider></mat-divider>
        <mat-dialog-actions>
            <mat-toolbar>
                <button type="button" mat-mini-fab color="primary" tabindex="1" (click)="cancel()" matTooltip="volver" cdkFocusRegionstart>
                    <mat-icon svgIcon="arrow-left"></mat-icon>
                </button>
                <span class="spacer-r"></span>
                <button type="submit" mat-raised-button color="accent" tabindex="2" [disabled]="!editForm.valid">Guardar</button>
            </mat-toolbar>
        </mat-dialog-actions>
    </form>
</div>

<div *ngIf="data.type === 'delete'">
    <mat-toolbar color="primary">
        <img class="imgEseDialog" alt="logo" title="logo" src="assets/images/logos/ese-logo.png">
        <span class="spacer-r"></span>
        <mat-icon svgIcon="account-remove"></mat-icon>
        <span>&nbsp;&nbsp;</span>
        <h1 mat-dialog-title>Borrar Usuario</h1>
    </mat-toolbar>
    <mat-divider></mat-divider>
    <mat-list class="listContainer2">
        <mat-list-item>
            <img matListAvatar [src]="sanitizer.bypassSecurityTrustResourceUrl('data:'+user?.avatar.type+';base64,' + user?.avatar.data)"
                alt="{{privilege}}" (click)="imageZoom.openDialogImage()">
            <h3 matLine> {{user.firstName}} {{user.lastName}} </h3>
            <p matLine>
                <span class="role-style">{{rolesToSpanish(user.roles)}}</span>
            </p>
        </mat-list-item>
        <nx-image-zoom #imageZoom [user]="user" [uriRole]="uriRole"></nx-image-zoom>
    </mat-list>
    <mat-divider></mat-divider>
    <mat-dialog-actions>
        <mat-toolbar>
            <button type="button" mat-raised-button color="primary" tabindex="1" (click)="cancel()" cdkFocusRegionstart>
                Cancelar
            </button>
            <span class="spacer-r"></span>
            <button type="button" mat-raised-button color="warn" (click)="delete()" tabindex="2">Borrar</button>
        </mat-toolbar>
    </mat-dialog-actions>
</div>