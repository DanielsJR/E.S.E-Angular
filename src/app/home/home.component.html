<div [ngClass]="themePicker.themeName" class="mat-app-background myWrapper">
    <div *ngIf="!isLoading" style="height: 5px;" class="p-bar"></div>
    <mat-progress-bar *ngIf="isLoading" mode="indeterminate" color="accent" class="p-bar"></mat-progress-bar>

    <!-- toolbar 1 -->
    <mat-toolbar color="primary" class="mainToolbar">
        <button type="button" mat-icon-button (click)="sidenavMenu.toggle()">
            <mat-icon svgIcon="backburger" [@tdRotate]="!sidenavMenu.opened"></mat-icon>
        </button>

        <img class="imgLogo" alt="E.S.E" src="assets/images/logos/ese-logo.png" [@tdBounce]="sideNavMenuState">


        <div matTooltip="Favoritos">
            <button type="button" mat-icon-button>
                <mat-icon svgIcon="star"></mat-icon>
            </button>
        </div>

        <!-- <span class="spacer-r"></span>
         <nx-logo [jelloState]=isScrolled></nx-logo>-->

        <span class="spacer-r"></span>

        <div matTooltip="Notificaciones">
            <button type="button" mat-icon-button>
                <mat-icon svgIcon="bell"></mat-icon>
            </button>
        </div>

        <nx-full-screen></nx-full-screen>
        <nx-theme-picker #themePicker></nx-theme-picker>

        <div matTooltip="Chat">
            <button type="button" mat-icon-button (click)="sidenavChat.toggle()">
                <mat-icon svgIcon="message"></mat-icon>
                <!--<mat-icon *ngIf="!sidenavChat.opened" svgIcon="message-outline"></mat-icon> -->
            </button>
        </div>
    </mat-toolbar>


    <mat-sidenav-container [style.background-color]="themePicker.isDark ? 'rgb(26, 26, 26)' : 'rgb(226, 226, 226)' "
        class="sidenavContainer">

        <!-- sidenavMenu -->
        <mat-sidenav #sidenavMenu mode="side" opened="false" class="sidenav" [position]=" 'start' "
            [@onSideNavChange]="sideNavMenuState">

            <!-- sidenav toobar -->
            <mat-toolbar class="sidenavToolbar">
                <div class="profileMini">
                    <mat-list>
                        <mat-list-item>
                            <img matListAvatar
                                [src]="sanitizer.bypassSecurityTrustResourceUrl('data:'+ user?.avatar?.type+';base64,' + user?.avatar?.data)"
                                alt="{{privilege | lowercase}}" [matMenuTriggerFor]="settings">
                            <h3 *ngIf="user" matLine> {{user | shortName}} </h3>
                            <p matLine>
                                <span *ngIf="user">{{user.roles | rolesToSpanish}}</span>
                            </p>
                            <!--<nx-image-zoom-user #imageZoom [avatar]="user?.avatar"></nx-image-zoom-user>-->
                        </mat-list-item>
                    </mat-list>

                    <span class="spacer-r"></span>

                   <!-- <div matTooltip="opciones" *ngIf="sideNavMenuState">
                        <button mat-icon-button [matMenuTriggerFor]="settings">
                            <mat-icon svgIcon="dots-vertical"></mat-icon>
                        </button>
                    </div>-->

                </div>
            </mat-toolbar>

            <mat-menu x-position="after" #settings="matMenu" [overlapTrigger]="false">

                <button mat-menu-item (click)="openSideNavAsyc(sidenavMenuProfile)">
                    <mat-icon svgIcon="account-circle"></mat-icon>
                    <span> Perfil </span>
                </button>

                <button mat-menu-item (click)="openSideNavAsyc(sidenavSettings)">
                    <mat-icon svgIcon="cogs"></mat-icon>
                    <span> Preferencias </span>
                </button>

                <button mat-menu-item (click)="openSideNavAsyc(sidenavSettings)">
                    <mat-icon svgIcon="help-circle"></mat-icon>
                    <span> Ayuda </span>
                </button>

                <button mat-menu-item (click)="logout()">
                    <mat-icon svgIcon="logout"></mat-icon>
                    <span> Salir </span>
                </button>

            </mat-menu>

            <!-- sidenav menus -->
            <mat-nav-list class="sidenavMainMenu">
                <nx-home-menu [roles]='roles'></nx-home-menu>
                <nx-users-menu [roles]='roles' [shortMenu]="!sideNavMenuState"></nx-users-menu>
                <nx-courses-menu [roles]='roles'></nx-courses-menu>
                <nx-subjects-menu [roles]='roles'></nx-subjects-menu>
                <nx-quiz-menu [roles]='roles' [shortMenu]="!sideNavMenuState"></nx-quiz-menu>
            </mat-nav-list>

            <!-- sidenav menu footer toobar -->
            <mat-toolbar class="sidenavToolbarFooter">
                <span class="spacer-r"></span>
                <button mat-icon-button (click)="sideNavMenuState = !sideNavMenuState">
                    <mat-icon *ngIf="sideNavMenuState" svgIcon="arrow-collapse-horizontal"></mat-icon>
                    <mat-icon *ngIf="!sideNavMenuState" svgIcon="arrow-expand-horizontal"></mat-icon>
                </button>
            </mat-toolbar>

            <!-- sidenav user-menu-profile -->
            <mat-drawer mode="slide" opened="false" #sidenavMenuProfile class="drawer">

                <mat-toolbar color="accent" class="sidenavToolbar">
                    <button mat-icon-button (click)="closeSideNavAsyc(sidenavMenuProfile)" #btnMenuProfileBack  style="margin-left: 12px;">
                        <mat-icon svgIcon="arrow-left"></mat-icon>
                    </button>
                    <span class="spacer-r"></span>
                    <mat-icon svgIcon="account-circle"></mat-icon>
                    <span>&nbsp;</span>
                    <h1>Perfil</h1>
                </mat-toolbar>

                <mat-list class="listAvatarContainer"
                    [style.background-color]="themePicker.isDark ? 'rgb(26, 26, 26)' : 'rgb(226, 226, 226)' ">
                    <mat-list-item>
                        <img matListAvatar
                            [src]="sanitizer.bypassSecurityTrustResourceUrl('data:'+user?.avatar.type+';base64,' + user?.avatar.data)"
                            alt="{{privilege}}" (click)="imageZoom.openDialogImage()">
                    </mat-list-item>
                    <nx-image-zoom-user #imageZoom [avatar]="user?.avatar"></nx-image-zoom-user>
                </mat-list>

                <mat-nav-list class="sideToolbarProfileMenu">
                    <mat-list-item (click)="sidenavProfile.toggle(); profileAction='usuario'">
                        <h4 mat-line>Usuario</h4>
                        <mat-icon matListIcon svgIcon="account-circle"></mat-icon>
                    </mat-list-item>

                    <mat-list-item (click)="sidenavProfile.toggle(); profileAction='personal'">
                        <h4 mat-line>Informacion Personal</h4>
                        <mat-icon matListIcon svgIcon="account"></mat-icon>
                    </mat-list-item>

                    <mat-list-item (click)="sidenavProfile.toggle(); profileAction='contacto'">
                        <h4 mat-line>Contacto</h4>
                        <mat-icon matListIcon svgIcon="phone"></mat-icon>
                    </mat-list-item>
                </mat-nav-list>

                <!-- sidenav user-profile -->
                <mat-drawer mode="side" opened="false" #sidenavProfile class="drawer">

                    <mat-toolbar color="accent" class="sidenavToolbar">
                        <button mat-icon-button (click)="sidenavProfile.toggle()" #btnProfileBack>
                            <mat-icon svgIcon="arrow-left"></mat-icon>
                        </button>
                        <mat-list style="flex-grow: 8">
                            <mat-list-item>
                                <img matListAvatar
                                    [src]="sanitizer.bypassSecurityTrustResourceUrl('data:'+user?.avatar.type+';base64,' + user?.avatar.data)"
                                    alt="{{privilege | lowercase}}">
                            </mat-list-item>
                        </mat-list>
                        <span class="spacer-r"></span>
                        <h1>{{profileTitle}}</h1>
                        <span>&nbsp;&nbsp;</span>
                        <mat-icon svgIcon="account-edit"></mat-icon>
                    </mat-toolbar>

                    <nx-user-profile *ngIf="user" [user]="user" [profileAction]="profileAction"
                        [isSidenavProfileOpen]="isSidenavProfileOpen" (title)="profileTitle=$event"></nx-user-profile>

                </mat-drawer>


            </mat-drawer>

            <!-- sidenav settings -->
            <mat-drawer mode="side" opened="false" #sidenavSettings class="drawer">

                <!-- sidenav settings toobar -->
                <mat-toolbar color="accent" class="sidenavToolbar">
                    <button mat-icon-button (click)="closeSideNavAsyc(sidenavSettings)" #btnSettingsBack  style="margin-left: 12px;">
                        <mat-icon svgIcon="arrow-left"></mat-icon>
                    </button>
                    <span class="spacer-r"></span>
                    <mat-icon svgIcon="cogs"></mat-icon>
                    <span>&nbsp;</span>
                    <h1>Preferencias</h1>
                </mat-toolbar>

                <!-- sidenav user-settings //TODO -->
                <nx-user-settings [user]="user"></nx-user-settings>
            </mat-drawer>

        </mat-sidenav>

        <!-- sidenavChat -->
        <mat-sidenav #sidenavChat mode="side" opened="false" class="sidenavChat" [position]=" 'end' "
            [@onSideNavChange]="sideNavChatState">

            <!-- sidenavChat toobar -->
            <mat-toolbar class="sidenavToolbar" color="accent">
            </mat-toolbar>

            <!-- sidenavChat content -->
            <mat-nav-list class="sidenavMainMenu">
            </mat-nav-list>

            <!-- sidenavChat footer toobar -->
            <mat-toolbar class="sidenavToolbarFooter">
                <button mat-icon-button (click)="sideNavChatState = !sideNavChatState" style="margin-right: 12px;">
                    <mat-icon *ngIf="sideNavChatState" svgIcon="arrow-collapse-horizontal"></mat-icon>
                    <mat-icon *ngIf="!sideNavChatState" svgIcon="arrow-expand-horizontal"></mat-icon>
                </button>

                <span class="spacer-r"></span>

                <mat-form-field appearance="outline" [floatLabel]=" 'never' "
                    [style.visibility]="!sideNavChatState? 'hidden': 'visible'">
                    <input matInput autocomplete="off" placeholder="Escribe un mensaje">
                    <button matSuffix mat-icon-button color="primary">
                        <mat-icon svgIcon="send" ></mat-icon>
                    </button>
                </mat-form-field>

            </mat-toolbar>

        </mat-sidenav>

        <!-- main content -->
        <mat-sidenav-content [@onMainContentChangeLeft]="sideNavMenuState"
            [@onMainContentChangeRight]="sideNavChatState">

            <!-- toolbar2 -->
            <mat-toolbar class="toolbar2" [color]="(toolbarColorAccent) ? 'accent':''"></mat-toolbar>

            <div class="mainContent">
                <div class="animWrapper" [@routeAnimations]="animString">
                    <div class="routerWrapper">
                        <router-outlet id="homeOutlet"></router-outlet>
                    </div>
                </div>
            </div>

        </mat-sidenav-content>

    </mat-sidenav-container>

</div>